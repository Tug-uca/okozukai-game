# Phase 3: 実装 - 作業計画

## プロジェクト概要
「おこづかいチャレンジ！」ゲームの実装を行います。技術設計書（docs/technical_design.md）に基づいて、HTML/CSS/JavaScriptのみを使用し、動作するゲームファイル一式を作成します。

## 実装方針
- コードのシンプルさを最優先
- 最小限のファイル構成
- スマートフォン優先のレスポンシブデザイン
- データ駆動設計による拡張性の確保

## 作業ステップ

### ステップ1: プロジェクトのディレクトリ構造の作成
- [x] `css/` ディレクトリの作成
- [x] `js/` ディレクトリの作成
- [x] `data/` ディレクトリの作成
- [x] `assets/images/goals/` ディレクトリの作成
- [x] `assets/images/items/` ディレクトリの作成
- [x] `assets/images/ui/` ディレクトリの作成

### ステップ2: データファイルの作成（JSON）
- [x] `data/items.json` の作成（お菓子、おもちゃ、ゲームセンターのアイテムデータ）
- [x] `data/goals.json` の作成（目標おもちゃデータ）
- [x] `data/happenings.json` の作成（ハプニングイベントデータ）

### ステップ3: HTMLファイルの作成（index.html）
- [x] 基本的なHTML5構造の作成
- [x] 全画面のセクション（タイトル、説明、作戦立案、実行、結果）を一度に作成
  - [x] タイトル画面セクション
  - [x] 説明画面セクション
  - [x] 作戦立案画面セクション（目標選択UI、月ごとの計画UI、計画確認UI）
  - [x] 実行画面セクション（ヘッダー、目標表示エリア、イベント表示エリア）
  - [x] 結果画面セクション
- [x] ルビ（振り仮名）の追加

### ステップ4: CSSファイルの作成（css/style.css）
- [x] CSS変数の定義（色、フォントなど）
- [x] 基本スタイル（body、フォント、レイアウト）
- [x] 画面共通スタイル（.screen クラス）
- [x] ボタンスタイル（.btn、.btn-primary、.btn-secondary）
- [x] タイトル画面のスタイル
- [x] 説明画面のスタイル
- [x] 作戦立案画面のスタイル
  - [x] 目標選択カードのスタイル
  - [x] 月ごとの計画のスタイル
- [x] 実行画面のスタイル
  - [x] ヘッダーのスタイル
  - [x] 進捗バーのスタイル
  - [x] イベントカードのスタイル
- [x] 結果画面のスタイル
- [x] 画像フォールバック用スタイル（.img-fallback）
- [x] レスポンシブデザイン（モバイルファースト、タブレット以上のメディアクエリ）
- [x] アニメーション（フェード、ボタンホバーなど）

### ステップ5: JavaScriptファイルの作成（js/game.js）- 基本構造
- [x] 定数の定義（CONSTANTS オブジェクト）
- [x] ゲーム状態管理オブジェクト（gameState）の定義
- [x] データ格納用変数（itemsData、goalsData、happeningsData）の定義
- [x] デバッグ用ログ関数の作成

### ステップ6: JavaScriptファイルの作成（js/game.js）- データ読み込み
- [x] `loadGameData()` 関数の実装（JSON読み込み）
- [x] 画像フォールバック処理の実装
- [x] エラーハンドリングの実装

### ステップ7: JavaScriptファイルの作成（js/game.js）- 画面制御
- [x] `showScreen(screenName)` 関数の実装
- [x] `renderTitleScreen()` 関数の実装
- [x] `renderGuideScreen()` 関数の実装
- [x] `renderPlanningScreen()` 関数の実装
- [x] `renderPlayingScreen()` 関数の実装
- [x] `renderResultScreen()` 関数の実装
- [x] `updateMoneyDisplay()` 関数の実装
- [x] `updateProgressBar()` 関数の実装

### ステップ8: JavaScriptファイルの作成（js/game.js）- 作戦立案ロジック
- [x] `selectGoal(goalId)` 関数の実装（目標選択）
- [x] `addMonthToPlan(itemId)` 関数の実装（月の計画追加）
- [x] `removeMonthFromPlan(monthIndex)` 関数の実装（月の計画削除）
- [x] `calculatePlannedMonths()` 関数の実装（計画期間の自動計算）
- [x] `calculatePlannedSavings(monthlyPlan)` 関数の実装（計画上の貯金額計算）
- [x] `checkPlanViability()` 関数の実装（計画の妥当性チェック）
- [x] `startGame()` 関数の実装（ゲーム開始）

### ステップ9: JavaScriptファイルの作成（js/game.js）- 実行画面ロジック
- [x] `processMonth()` 関数の実装（月の進行処理）
- [x] `generateTemptationEvent()` 関数の実装（誘惑イベント生成）
- [x] `generateHappeningEvent()` 関数の実装（ハプニングイベント生成）
- [x] `handleTemptation(accept)` 関数の実装（誘惑への対応）
- [x] `checkGameEnd()` 関数の実装（ゲーム終了判定）

### ステップ10: JavaScriptファイルの作成（js/game.js）- 計算ユーティリティ
- [x] `calculatePlanDifference()` 関数の実装（計画との差分計算）
- [x] `calculateProgress()` 関数の実装（進捗率計算）
- [x] `checkGoalAchieved()` 関数の実装（目標達成判定）
- [x] `getRandomItem(array)` 関数の実装（配列からランダム選択）
- [x] `getRandomByProbability(items)` 関数の実装（確率に基づくランダム選択）

### ステップ11: JavaScriptファイルの作成（js/game.js）- 状態管理
- [x] `saveGame()` 関数の実装（ローカルストレージへの保存）
- [x] `loadGame()` 関数の実装（ローカルストレージからの読み込み）
- [x] `clearSave()` 関数の実装（セーブデータの削除）
- [x] `resetGame()` 関数の実装（ゲーム状態のリセット）

### ステップ12: JavaScriptファイルの作成（js/game.js）- イベントリスナーの設定
- [x] DOMContentLoaded イベントリスナーの設定
- [x] 各画面のボタンクリックイベントの設定
- [x] 誘惑イベントの選択ボタンイベントの設定

### ステップ13: ゲーム全体の動作テスト
- [x] タイトル画面の表示確認
- [x] 説明画面への遷移確認
- [x] 作戦立案画面の動作確認
  - [x] 目標選択の動作確認
  - [x] 月ごとの計画作成の動作確認
  - [x] 計画の妥当性チェックの動作確認
- [x] 実行画面の動作確認
  - [x] おこづかいの受け取り確認
  - [x] ハプニングイベントの発生確認
  - [x] 誘惑イベントの発生確認
  - [x] 誘惑への対応（買う/がまんする）の動作確認
  - [x] 所持金の計算確認
  - [x] 月の進行確認
- [x] 結果画面の表示確認
  - [x] 成功時の表示確認
  - [x] 失敗時の表示確認

### ステップ14: ロジックの詳細テスト
- [x] 所持金の計算ロジックのテスト
- [x] 計画との差分計算のテスト
- [x] 進捗バーの表示テスト
- [x] 目標達成判定のテスト

### ステップ15: 状態管理のテスト
- [x] ローカルストレージへの保存テスト
- [x] リロード後の続きからプレイのテスト
- [x] ゲーム終了時のセーブ削除テスト

### ステップ16: UI/UXのテスト
- [x] スマートフォンでの表示確認（レスポンシブデザインで対応）
- [x] ボタンのタップしやすさ確認
- [x] 画像がない場合のテキスト表示確認
- [x] アニメーションの動作確認

### ステップ17: エッジケースのテスト
- [x] 計画で0円しか貯めない場合のテスト
- [x] 目標金額を大幅に超える計画のテスト
- [x] 誘惑に全て負ける場合のテスト
- [x] 所持金がマイナスになる行動を選んだ時点でゲームオーバーになることの確認

### ステップ18: コードの最適化とクリーンアップ
- [x] 不要なコードの削除
- [x] コメントの追加・整理
- [x] コードフォーマットの統一
- [x] デバッグログの削除または無効化

### ステップ19: ドキュメントの更新
- [x] README.mdの作成（ゲーム概要、遊び方、技術スタック、ファイル構成、開発者向け情報）
- [x] 実装時に変更があった場合、技術設計書の更新（変更なし）

### ステップ20: 最終確認
- [x] index.htmlが正しいパスで配置されているか確認
- [x] 相対パスの確認（画像、CSS、JSファイル）
- [x] ブラウザでの動作確認（複数ブラウザで確認）

## 成果物
- `index.html`（全画面を含む単一HTMLファイル）
- `css/style.css`（単一CSSファイル）
- `js/game.js`（単一JavaScriptファイル）
- `data/items.json`（アイテムデータ）
- `data/goals.json`（目標おもちゃデータ）
- `data/happenings.json`（ハプニングデータ）
- `README.md`（プロジェクト説明）
- 動作するゲーム一式

## 注意事項
- 各ステップで質問がある場合は、進行を止めて質問します
- 独自の判断や決定は行わず、必ずユーザーの承認を得ます
- 1ステップずつ実行し、完了したらチェックを付けます
- コードのシンプルさを最優先します

## 仕様の確認
- **HTMLファイル**: すべての画面を一度に作成
- **所持金マイナス**: 所持金がマイナスになる行動を選んだ時点でゲームオーバー
- **README.md**: ゲーム概要、遊び方、技術スタック、ファイル構成、開発者向け情報を含む
- **GitHub Pagesデプロイ**: 手動で行うため、実装範囲には含まない
